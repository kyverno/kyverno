should-fail:
  - description: Policy with backgound enabled and referencing user infos should be rejected
    kubectl:
      args:
        - create
        - -f 
        - test/conformance/manifests/should-fail/background-userinfo-1.yaml
      expect:
        exitcode: 1
        stderr: >-
          Error from server: error when creating "test/conformance/manifests/should-fail/background-userinfo-1.yaml":
          admission webhook "validate-policy.kyverno.svc" denied the request: only select variables are allowed in background mode.
          Set spec.background=false to disable background mode for this policy rule: variable "{{request.roles}} is not allowed 
  - description: Policy with backgound enabled and referencing user infos should be rejected
    kubectl:
      args:
        - create
        - -f 
        - test/conformance/manifests/should-fail/background-userinfo-2.yaml
      expect:
        exitcode: 1
        stderr: >-
          Error from server: error when creating "test/conformance/manifests/should-fail/background-userinfo-2.yaml":
          admission webhook "validate-policy.kyverno.svc" denied the request:
          only select variables are allowed in background mode.
          Set spec.background=false to disable background mode for this policy rule:
          invalid variable used at path: spec/rules[0]/match/clusterRoles
  - description: Policy with backgound enabled and referencing user infos should be rejected
    kubectl:
      args:
        - create
        - -f 
        - test/conformance/manifests/should-fail/background-userinfo-3.yaml
      expect:
        exitcode: 1
        stderr: >-
          Error from server: error when creating "test/conformance/manifests/should-fail/background-userinfo-3.yaml":
          admission webhook "validate-policy.kyverno.svc" denied the request: only select variables are allowed in background mode.
          Set spec.background=false to disable background mode for this policy rule: variable "{{request.userInfo}} is not allowed 
  - description: Policy with backgound enabled and referencing user infos should be rejected
    kubectl:
      args:
        - create
        - -f 
        - test/conformance/manifests/should-fail/background-userinfo-4.yaml
      expect:
        exitcode: 1
        stderr: >-
          Error from server: error when creating "test/conformance/manifests/should-fail/background-userinfo-4.yaml":
          admission webhook "validate-policy.kyverno.svc" denied the request: only select variables are allowed in background mode.
          Set spec.background=false to disable background mode for this policy rule: variable "{{serviceAccountName}} is not allowed 
