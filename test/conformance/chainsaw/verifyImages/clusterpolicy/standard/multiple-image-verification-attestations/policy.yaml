apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: check-image-attestation
spec:
  validationFailureAction: Enforce
  webhookTimeoutSeconds: 30
  failurePolicy: Fail  
  rules:
    - name: verify-attestation-notary
      match:
        any:
        - resources:
            kinds:
              - Pod
      context:
      - name: keys
        configMap:
          name: keys
          namespace: notary-verify-attestation
      verifyImages:
      - type: Notary
        imageReferences:
          - "ghcr.io/kyverno/test-verify-image*"
        attestations:
          - type: sbom/cyclone-dx
            name: one
            attestors:
            - entries:
              - certificates: 
                  cert: "{{ keys.data.certificate }}"
          - type: sbom/cyclone-dx
            name: two
            attestors:
            - entries:
              - certificates: 
                  cert: "{{ keys.data.certificate }}"
        validate:
          deny:
            conditions:
              any:
                - key: '{{ one }}'
                  operator: Equals
                  value: '{{ two }}'
          message: Sample Validation