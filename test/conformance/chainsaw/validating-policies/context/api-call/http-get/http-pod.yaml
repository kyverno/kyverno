apiVersion: v1
kind: Pod
metadata:
  namespace: default
  name: test-api
  labels:
    app: test-api
spec:
  containers:
  - name: test-api
    image: python:3.9-slim
    command: ["sh", "-c"]
    args:
    - |
      cat > app.py <<'PY'
      from http.server import BaseHTTPRequestHandler, HTTPServer
      import json

      class Handler(BaseHTTPRequestHandler):
          def do_GET(self):
              self.send_response(200)
              self.send_header('Content-Type', 'application/json')
              self.end_headers()
              self.wfile.write(json.dumps({"metadata": {"labels": {"app": "test"}}}).encode())

          def log_message(self, format, *args):
              return

      if __name__ == '__main__':
          HTTPServer(('', 5000), Handler).serve_forever()
      PY
      python app.py
    ports:
    - containerPort: 5000
