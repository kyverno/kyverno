apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  annotations:
    admissions.enforcer/disabled: "true"
  labels:
    webhook.kyverno.io/managed-by: kyverno
  name: kyverno-resource-mutating-webhook-cfg
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    service:
      name: kyverno-svc
      namespace: kyverno
      path: /ivpol/mutate/check-signed-images
      port: 443
  failurePolicy: Fail
  matchConditions:
  - expression: '!((object.apiVersion == ''v1'' && object.kind ==''Pod'')) || (has(object.metadata.labels)
      && has(object.metadata.labels.prod) && object.metadata.labels.prod == ''true'')'
    name: autogen-check-prod-label
  - expression: '!((object.apiVersion == ''batch/v1'' && object.kind ==''CronJob''))
      || (has(object.spec.jobTemplate.spec.template.metadata.labels) && has(object.spec.jobTemplate.spec.template.metadata.labels.prod)
      && object.spec.jobTemplate.spec.template.metadata.labels.prod == ''true'')'
    name: autogen-cronjobs-check-prod-label
  - expression: '!((object.apiVersion == ''apps/v1'' && object.kind ==''DaemonSet'')
      || (object.apiVersion == ''apps/v1'' && object.kind ==''Deployment'') || (object.apiVersion
      == ''apps/v1'' && object.kind ==''ReplicaSet'') || (object.apiVersion == ''apps/v1''
      && object.kind ==''StatefulSet'') || (object.apiVersion == ''batch/v1'' && object.kind
      ==''Job'')) || (has(object.spec.template.metadata.labels) && has(object.spec.template.metadata.labels.prod)
      && object.spec.template.metadata.labels.prod == ''true'')'
    name: autogen-defaults-check-prod-label
  matchPolicy: Equivalent
  name: ivpol.mutate.kyverno.svc-fail-finegrained-check-signed-images
  namespaceSelector: {}
  objectSelector: {}
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - pods
    scope: '*'
  - apiGroups:
    - batch
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - cronjobs
    scope: '*'
  - apiGroups:
    - apps
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - daemonsets
    - deployments
    - replicasets
    - statefulsets
    scope: '*'
  - apiGroups:
    - batch
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - jobs
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 20

---

apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  annotations:
    admissions.enforcer/disabled: "true"
  labels:
    webhook.kyverno.io/managed-by: kyverno
  name: kyverno-resource-validating-webhook-cfg
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM3VENDQWRXZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFZTVJZd0ZBWURWUVFEREEwcUxtdDUKZG1WeWJtOHVjM1pqTUI0WERUSTFNRFV5TXpFMU1qTXpNRm9YRFRJMk1EVXlNekUyTWpNek1Gb3dHREVXTUJRRwpBMVVFQXd3TktpNXJlWFpsY201dkxuTjJZekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DCmdnRUJBUG1RazNGWjlQZDlUckpsbGdEcVNFZ2FJb1AwempxcnBWLzBEQ1RSYVhhYVN2b1lCNFVkU0pkN01NMDcKSE1KVWVDN296VEh1NE9tQ00zb1ZmZ0NFY2ZEMWIvWXVrRWt5TUFSQ3JmeEloaVptNEF5ZDcvM3pxRFd1bHI3Wgp3T3FTczBmenROeWFBdnFTMW5SMjRZenA5a1lWWS9ZMEV3OUYwL1o5VWJTMWFjMXdYRGY3U1kvaFNnRVRraklRCmRjVW44alVvUEVtdmwzTFBMbXM4dmFjc3dTNEk0bmthM0k3dXlNR3BOQWg0NE9VSW1OQXR6MHdodDl1Y1JPdUsKb1REcXNia25hdmVCNWtXT2Jienp0V2hqZWNuZCtTZHZLVnNqTnNmZVo4dG1OcnZZM0dQZnRRRlJvT1ZCUWQ4agp3VE9jbk96OGdlWktTMVpzV3NZMEhCQTZhZjhDQXdFQUFhTkNNRUF3RGdZRFZSMFBBUUgvQkFRREFnS2tNQThHCkExVWRFd0VCL3dRRk1BTUJBZjh3SFFZRFZSME9CQllFRlByZjFaR2tVMWRmSENVc29sR2tNMWFaMkVzNk1BMEcKQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUJkQlNvZTZMbnorNzF1c2JBQzl6c1RyUUpTazB1SXJqN2NrY2tXU0NDbgpwVEJ1OGZmaTd3K3JUa3I3MVBqQmZZdmhubjNoeWNoWlZkaUw4MkpvQnpBd3BOWXlvOTZ4aU5LbFlRWmwrZlU4CjBXbEZIOGs3MFNQQmRTOENKRThUdDhoTXFvZzg0Y1VJajduZ0NBTUQ0M04vNFc5cjhwN2c0ek9qazY5TzVHTE8KdzQzRGpsUFJXR3FmUEJ6TTdzMGZyNTB5azlodDFJVDkxSzA0SStITnhkVU5KYnVFeTVTdlZicHU0SEZGR3hBWgpYcVh2aTBjeEhYR2dHV1FXZGVKS2VQYXZYUXRYOXcwNzNvRCt4dWZQTFlCTkVkWFNEOEFZRnFKenQrdkJFV0dqCll2aHg2Wnhzc0MvK25zU1lSRDUxQWVJZEZkVGNiaUw1RFhTMms2NjBZUUw4Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    service:
      name: kyverno-svc
      namespace: kyverno
      path: /vpol/disallow-privilege-escalation
      port: 443
  failurePolicy: Fail
  matchConditions:
  - expression: '!((object.apiVersion == ''v1'' && object.kind ==''Pod'')) || (has(object.metadata.labels)
      && has(object.metadata.labels.prod) && object.metadata.labels.prod == ''true'')'
    name: autogen-check-prod-label
  - expression: '!((object.apiVersion == ''batch/v1'' && object.kind ==''CronJob''))
      || (has(object.spec.jobTemplate.spec.template.metadata.labels) && has(object.spec.jobTemplate.spec.template.metadata.labels.prod)
      && object.spec.jobTemplate.spec.template.metadata.labels.prod == ''true'')'
    name: autogen-cronjobs-check-prod-label
  - expression: '!((object.apiVersion == ''apps/v1'' && object.kind ==''DaemonSet'')
      || (object.apiVersion == ''apps/v1'' && object.kind ==''Deployment'') || (object.apiVersion
      == ''apps/v1'' && object.kind ==''ReplicaSet'') || (object.apiVersion == ''apps/v1''
      && object.kind ==''StatefulSet'') || (object.apiVersion == ''batch/v1'' && object.kind
      ==''Job'')) || (has(object.spec.template.metadata.labels) && has(object.spec.template.metadata.labels.prod)
      && object.spec.template.metadata.labels.prod == ''true'')'
    name: autogen-defaults-check-prod-label
  matchPolicy: Equivalent
  name: vpol.validate.kyverno.svc-fail-finegrained-disallow-privilege-escalation
  namespaceSelector: {}
  objectSelector: {}
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - pods
    scope: '*'
  - apiGroups:
    - batch
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - cronjobs
    scope: '*'
  - apiGroups:
    - apps
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - daemonsets
    - deployments
    - replicasets
    - statefulsets
    scope: '*'
  - apiGroups:
    - batch
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - jobs
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 10
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM3VENDQWRXZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFZTVJZd0ZBWURWUVFEREEwcUxtdDUKZG1WeWJtOHVjM1pqTUI0WERUSTFNRFV5TXpFMU1qTXpNRm9YRFRJMk1EVXlNekUyTWpNek1Gb3dHREVXTUJRRwpBMVVFQXd3TktpNXJlWFpsY201dkxuTjJZekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DCmdnRUJBUG1RazNGWjlQZDlUckpsbGdEcVNFZ2FJb1AwempxcnBWLzBEQ1RSYVhhYVN2b1lCNFVkU0pkN01NMDcKSE1KVWVDN296VEh1NE9tQ00zb1ZmZ0NFY2ZEMWIvWXVrRWt5TUFSQ3JmeEloaVptNEF5ZDcvM3pxRFd1bHI3Wgp3T3FTczBmenROeWFBdnFTMW5SMjRZenA5a1lWWS9ZMEV3OUYwL1o5VWJTMWFjMXdYRGY3U1kvaFNnRVRraklRCmRjVW44alVvUEVtdmwzTFBMbXM4dmFjc3dTNEk0bmthM0k3dXlNR3BOQWg0NE9VSW1OQXR6MHdodDl1Y1JPdUsKb1REcXNia25hdmVCNWtXT2Jienp0V2hqZWNuZCtTZHZLVnNqTnNmZVo4dG1OcnZZM0dQZnRRRlJvT1ZCUWQ4agp3VE9jbk96OGdlWktTMVpzV3NZMEhCQTZhZjhDQXdFQUFhTkNNRUF3RGdZRFZSMFBBUUgvQkFRREFnS2tNQThHCkExVWRFd0VCL3dRRk1BTUJBZjh3SFFZRFZSME9CQllFRlByZjFaR2tVMWRmSENVc29sR2tNMWFaMkVzNk1BMEcKQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUJkQlNvZTZMbnorNzF1c2JBQzl6c1RyUUpTazB1SXJqN2NrY2tXU0NDbgpwVEJ1OGZmaTd3K3JUa3I3MVBqQmZZdmhubjNoeWNoWlZkaUw4MkpvQnpBd3BOWXlvOTZ4aU5LbFlRWmwrZlU4CjBXbEZIOGs3MFNQQmRTOENKRThUdDhoTXFvZzg0Y1VJajduZ0NBTUQ0M04vNFc5cjhwN2c0ek9qazY5TzVHTE8KdzQzRGpsUFJXR3FmUEJ6TTdzMGZyNTB5azlodDFJVDkxSzA0SStITnhkVU5KYnVFeTVTdlZicHU0SEZGR3hBWgpYcVh2aTBjeEhYR2dHV1FXZGVKS2VQYXZYUXRYOXcwNzNvRCt4dWZQTFlCTkVkWFNEOEFZRnFKenQrdkJFV0dqCll2aHg2Wnhzc0MvK25zU1lSRDUxQWVJZEZkVGNiaUw1RFhTMms2NjBZUUw4Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    service:
      name: kyverno-svc
      namespace: kyverno
      path: /ivpol/validate/check-signed-images
      port: 443
  failurePolicy: Fail
  matchConditions:
  - expression: '!((object.apiVersion == ''v1'' && object.kind ==''Pod'')) || (has(object.metadata.labels)
      && has(object.metadata.labels.prod) && object.metadata.labels.prod == ''true'')'
    name: autogen-check-prod-label
  - expression: '!((object.apiVersion == ''batch/v1'' && object.kind ==''CronJob''))
      || (has(object.spec.jobTemplate.spec.template.metadata.labels) && has(object.spec.jobTemplate.spec.template.metadata.labels.prod)
      && object.spec.jobTemplate.spec.template.metadata.labels.prod == ''true'')'
    name: autogen-cronjobs-check-prod-label
  - expression: '!((object.apiVersion == ''apps/v1'' && object.kind ==''DaemonSet'')
      || (object.apiVersion == ''apps/v1'' && object.kind ==''Deployment'') || (object.apiVersion
      == ''apps/v1'' && object.kind ==''ReplicaSet'') || (object.apiVersion == ''apps/v1''
      && object.kind ==''StatefulSet'') || (object.apiVersion == ''batch/v1'' && object.kind
      ==''Job'')) || (has(object.spec.template.metadata.labels) && has(object.spec.template.metadata.labels.prod)
      && object.spec.template.metadata.labels.prod == ''true'')'
    name: autogen-defaults-check-prod-label
  matchPolicy: Equivalent
  name: ivpol.validate.kyverno.svc-fail-finegrained-check-signed-images
  namespaceSelector: {}
  objectSelector: {}
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - pods
    scope: '*'
  - apiGroups:
    - batch
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - cronjobs
    scope: '*'
  - apiGroups:
    - apps
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - daemonsets
    - deployments
    - replicasets
    - statefulsets
    scope: '*'
  - apiGroups:
    - batch
    apiVersions:
    - v1
    operations:
    - CREATE
    resources:
    - jobs
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 20