# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: Sync Label Colors

# On-demand workflow to create or update label colors from .github/labels.yml.
# Run manually from Actions → Sync Label Colors → Run workflow.

on:
  push:
    branches:
      - main
    paths:
      - .github/labels.yml
  workflow_dispatch:

permissions:
  issues: write

jobs:
  sync-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Sync labels from config
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7.0.1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const yaml = require('js-yaml');

            const file = fs.readFileSync('.github/labels.yml', 'utf8');
            const labels = yaml.load(file);

            for (const label of labels) {
              try {
                await github.rest.issues.updateLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description || '',
                });
                core.info(`Updated label: ${label.name}`);
              } catch (e) {
                if (e.status === 404) {
                  await github.rest.issues.createLabel({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    name: label.name,
                    color: label.color,
                    description: label.description || '',
                  });
                  core.info(`Created label: ${label.name}`);
                } else {
                  core.warning(`Failed to sync label "${label.name}": ${e.message}`);
                }
              }
            }

            core.info(`Done — synced ${labels.length} labels.`);
